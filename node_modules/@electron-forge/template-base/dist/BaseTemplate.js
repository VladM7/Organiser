"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.BaseTemplate = void 0;

require("source-map-support/register");

var _asyncOra = require("@electron-forge/async-ora");

var _debug = _interopRequireDefault(require("debug"));

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _path = _interopRequireDefault(require("path"));

var _determineAuthor = _interopRequireDefault(require("./determine-author"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

const currentForgeVersion = require('../package.json').version;

const d = (0, _debug.default)('electron-forge:template:base');

const tmplDir = _path.default.resolve(__dirname, '../tmpl');

class BaseTemplate {
  constructor() {
    _defineProperty(this, "templateDir", tmplDir);
  }

  get devDependencies() {
    const packageJSONPath = _path.default.join(this.templateDir, 'package.json');

    if (_fsExtra.default.pathExistsSync(packageJSONPath)) {
      const packageDevDeps = _fsExtra.default.readJsonSync(packageJSONPath).devDependencies;

      if (packageDevDeps) {
        return Object.entries(packageDevDeps).map(([packageName, version]) => {
          if (version === 'ELECTRON_FORGE/VERSION') {
            version = currentForgeVersion;
          }

          return `${packageName}@${version}`;
        });
      }
    }

    return [];
  }

  async initializeTemplate(directory, {
    copyCIFiles
  }) {
    await (0, _asyncOra.asyncOra)('Copying Starter Files', async () => {
      d('creating directory:', _path.default.resolve(directory, 'src'));
      await _fsExtra.default.mkdirs(_path.default.resolve(directory, 'src'));
      const rootFiles = ['_gitignore'];
      if (copyCIFiles) rootFiles.push(...['_travis.yml', '_appveyor.yml']);
      const srcFiles = ['index.css', 'index.js', 'index.html'];

      for (const file of rootFiles) {
        await this.copy(_path.default.resolve(tmplDir, file), _path.default.resolve(directory, file.replace(/^_/, '.')));
      }

      for (const file of srcFiles) {
        await this.copy(_path.default.resolve(tmplDir, file), _path.default.resolve(directory, 'src', file));
      }
    });
    await this.initializePackageJSON(directory);
  }

  async copy(source, target) {
    d(`copying "${source}" --> "${target}"`);
    await _fsExtra.default.copy(source, target);
  }

  async copyTemplateFile(destDir, basename) {
    await this.copy(_path.default.join(this.templateDir, basename), _path.default.resolve(destDir, basename));
  }

  async initializePackageJSON(directory) {
    await (0, _asyncOra.asyncOra)('Initializing NPM Module', async () => {
      const packageJSON = await _fsExtra.default.readJson(_path.default.resolve(__dirname, '../tmpl/package.json')); // eslint-disable-next-line no-multi-assign

      packageJSON.productName = packageJSON.name = _path.default.basename(directory).toLowerCase();
      packageJSON.author = await (0, _determineAuthor.default)(directory);
      packageJSON.scripts.lint = 'echo "No linting configured"';
      d('writing package.json to:', directory);
      await _fsExtra.default.writeJson(_path.default.resolve(directory, 'package.json'), packageJSON, {
        spaces: 2
      });
    });
  }

  async updateFileByLine(inputPath, lineHandler, outputPath) {
    const fileContents = (await _fsExtra.default.readFile(inputPath, 'utf8')).split('\n').map(lineHandler).join('\n');
    await _fsExtra.default.writeFile(outputPath || inputPath, fileContents);

    if (outputPath !== undefined) {
      await _fsExtra.default.remove(inputPath);
    }
  }

}

exports.BaseTemplate = BaseTemplate;

var _default = new BaseTemplate();

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9CYXNlVGVtcGxhdGUudHMiXSwibmFtZXMiOlsiY3VycmVudEZvcmdlVmVyc2lvbiIsInJlcXVpcmUiLCJ2ZXJzaW9uIiwiZCIsInRtcGxEaXIiLCJwYXRoIiwicmVzb2x2ZSIsIl9fZGlybmFtZSIsIkJhc2VUZW1wbGF0ZSIsImRldkRlcGVuZGVuY2llcyIsInBhY2thZ2VKU09OUGF0aCIsImpvaW4iLCJ0ZW1wbGF0ZURpciIsImZzIiwicGF0aEV4aXN0c1N5bmMiLCJwYWNrYWdlRGV2RGVwcyIsInJlYWRKc29uU3luYyIsIk9iamVjdCIsImVudHJpZXMiLCJtYXAiLCJwYWNrYWdlTmFtZSIsImluaXRpYWxpemVUZW1wbGF0ZSIsImRpcmVjdG9yeSIsImNvcHlDSUZpbGVzIiwibWtkaXJzIiwicm9vdEZpbGVzIiwicHVzaCIsInNyY0ZpbGVzIiwiZmlsZSIsImNvcHkiLCJyZXBsYWNlIiwiaW5pdGlhbGl6ZVBhY2thZ2VKU09OIiwic291cmNlIiwidGFyZ2V0IiwiY29weVRlbXBsYXRlRmlsZSIsImRlc3REaXIiLCJiYXNlbmFtZSIsInBhY2thZ2VKU09OIiwicmVhZEpzb24iLCJwcm9kdWN0TmFtZSIsIm5hbWUiLCJ0b0xvd2VyQ2FzZSIsImF1dGhvciIsInNjcmlwdHMiLCJsaW50Iiwid3JpdGVKc29uIiwic3BhY2VzIiwidXBkYXRlRmlsZUJ5TGluZSIsImlucHV0UGF0aCIsImxpbmVIYW5kbGVyIiwib3V0cHV0UGF0aCIsImZpbGVDb250ZW50cyIsInJlYWRGaWxlIiwic3BsaXQiLCJ3cml0ZUZpbGUiLCJ1bmRlZmluZWQiLCJyZW1vdmUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUVBOztBQUNBOztBQUVBOzs7Ozs7QUFFQSxNQUFNQSxtQkFBbUIsR0FBR0MsT0FBTyxDQUFDLGlCQUFELENBQVAsQ0FBMkJDLE9BQXZEOztBQUVBLE1BQU1DLENBQUMsR0FBRyxvQkFBTSw4QkFBTixDQUFWOztBQUNBLE1BQU1DLE9B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QVUsS0FBS0ssU0FBbkIsRUFBOEI7QUFDNUIsWUFBTTFDLGlCQUFHMkMsTUFBSCxDQUFVUixTQUFWLENBQU47QUFDRDtBQUNGOztBQXhFZ0Q7Ozs7ZUEyRXBDLElBQUl4QyxZQUFKLEUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3luY09yYSB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9hc3luYy1vcmEnO1xuaW1wb3J0IGRlYnVnIGZyb20gJ2RlYnVnJztcbmltcG9ydCB7IEZvcmdlVGVtcGxhdGUsIEluaXRUZW1wbGF0ZU9wdGlvbnMgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2Uvc2hhcmVkLXR5cGVzJztcbmltcG9ydCBmcyBmcm9tICdmcy1leHRyYSc7XG5pbXBvcnQgcGF0aCBmcm9tICdwYXRoJztcblxuaW1wb3J0IGRldGVybWluZUF1dGhvciBmcm9tICcuL2RldGVybWluZS1hdXRob3InO1xuXG5jb25zdCBjdXJyZW50Rm9yZ2VWZXJzaW9uID0gcmVxdWlyZSgnLi4vcGFja2FnZS5qc29uJykudmVyc2lvbjtcblxuY29uc3QgZCA9IGRlYnVnKCdlbGVjdHJvbi1mb3JnZTp0ZW1wbGF0ZTpiYXNlJyk7XG5jb25zdCB0bXBsRGlyID0gcGF0aC5yZXNvbHZlKF9fZGlybmFtZSwgJy4uL3RtcGwnKTtcblxuZXhwb3J0IGNsYXNzIEJhc2VUZW1wbGF0ZSBpbXBsZW1lbnRzIEZvcmdlVGVtcGxhdGUge1xuICBwdWJsaWMgdGVtcGxhdGVEaXIgPSB0bXBsRGlyO1xuXG4gIGdldCBkZXZEZXBlbmRlbmNpZXMoKTogc3RyaW5nW10ge1xuICAgIGNvbnN0IHBhY2thZ2VKU09OUGF0aCA9IHBhdGguam9pbih0aGlzLnRlbXBsYXRlRGlyLCAncGFja2FnZS5qc29uJyk7XG4gICAgaWYgKGZzLnBhdGhFeGlzdHNTeW5jKHBhY2thZ2VKU09OUGF0aCkpIHtcbiAgICAgIGNvbnN0IHBhY2thZ2VEZXZEZXBzID0gZnMucmVhZEpzb25TeW5jKHBhY2thZ2VKU09OUGF0aCkuZGV2RGVwZW5kZW5jaWVzO1xuICAgICAgaWYgKHBhY2thZ2VEZXZEZXBzKSB7XG4gICAgICAgIHJldHVybiBPYmplY3QuZW50cmllcyhwYWNrYWdlRGV2RGVwcykubWFwKChbcGFja2FnZU5hbWUsIHZlcnNpb25dKSA9PiB7XG4gICAgICAgICAgaWYgKHZlcnNpb24gPT09ICdFTEVDVFJPTl9GT1JHRS9WRVJTSU9OJykge1xuICAgICAgICAgICAgdmVyc2lvbiA9IGN1cnJlbnRGb3JnZVZlcnNpb247XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBgJHtwYWNrYWdlTmFtZX1AJHt2ZXJzaW9ufWA7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBbXTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBpbml0aWFsaXplVGVtcGxhdGUoZGlyZWN0b3J5OiBzdHJpbmcsIHsgY29weUNJRmlsZXMgfTogSW5pdFRlbXBsYXRlT3B0aW9ucykge1xuICAgIGF3YWl0IGFzeW5jT3JhKCdDb3B5aW5nIFN0YXJ0ZXIgRmlsZXMnLCBhc3luYyAoKSA9PiB7XG4gICAgICBkKCdjcmVhdGluZyBkaXJlY3Rvcnk6JywgcGF0aC5yZXNvbHZlKGRpcmVjdG9yeSwgJ3NyYycpKTtcbiAgICAgIGF3YWl0IGZzLm1rZGlycyhwYXRoLnJlc29sdmUoZGlyZWN0b3J5LCAnc3JjJykpO1xuICAgICAgY29uc3Qgcm9vdEZpbGVzID0gWydfZ2l0aWdub3JlJ107XG4gICAgICBpZiAoY29weUNJRmlsZXMpIHJvb3RGaWxlcy5wdXNoKC4uLlsnX3RyYXZpcy55bWwnLCAnX2FwcHZleW9yLnltbCddKTtcbiAgICAgIGNvbnN0IHNyY0ZpbGVzID0gWydpbmRleC5jc3MnLCAnaW5kZXguanMnLCAnaW5kZXguaHRtbCddO1xuXG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2Ygcm9vdEZpbGVzKSB7XG4gICAgICAgIGF3YWl0IHRoaXMuY29weShwYXRoLnJlc29sdmUodG1wbERpciwgZmlsZSksIHBhdGgucmVzb2x2ZShkaXJlY3RvcnksIGZpbGUucmVwbGFjZSgvXl8vLCAnLicpKSk7XG4gICAgICB9XG4gICAgICBmb3IgKGNvbnN0IGZpbGUgb2Ygc3JjRmlsZXMpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5jb3B5KHBhdGgucmVzb2x2ZSh0bXBsRGlyLCBmaWxlKSwgcGF0aC5yZXNvbHZlKGRpcmVjdG9yeSwgJ3NyYycsIGZpbGUpKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGF3YWl0IHRoaXMuaW5pdGlhbGl6ZVBhY2thZ2VKU09OKGRpcmVjdG9yeSk7XG4gIH1cblxuICBhc3luYyBjb3B5KHNvdXJjZTogc3RyaW5nLCB0YXJnZXQ6IHN0cmluZykge1xuICAgIGQoYGNvcHlpbmcgXCIke3NvdXJjZX1cIiAtLT4gXCIke3RhcmdldH1cImApO1xuICAgIGF3YWl0IGZzLmNvcHkoc291cmNlLCB0YXJnZXQpO1xuICB9XG5cbiAgYXN5bmMgY29weVRlbXBsYXRlRmlsZShkZXN0RGlyOiBzdHJpbmcsIGJhc2VuYW1lOiBzdHJpbmcpIHtcbiAgICBhd2FpdCB0aGlzLmNvcHkocGF0aC5qb2luKHRoaXMudGVtcGxhdGVEaXIhLCBiYXNlbmFtZSksIHBhdGgucmVzb2x2ZShkZXN0RGlyLCBiYXNlbmFtZSkpO1xuICB9XG5cbiAgYXN5bmMgaW5pdGlhbGl6ZVBhY2thZ2VKU09OKGRpcmVjdG9yeTogc3RyaW5nKSB7XG4gICAgYXdhaXQgYXN5bmNPcmEoJ0luaXRpYWxpemluZyBOUE0gTW9kdWxlJywgYXN5bmMgKCkgPT4ge1xuICAgICAgY29uc3QgcGFja2FnZUpTT04gPSBhd2FpdCBmcy5yZWFkSnNvbihwYXRoLnJlc29sdmUoX19kaXJuYW1lLCAnLi4vdG1wbC9wYWNrYWdlLmpzb24nKSk7XG4gICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tbXVsdGktYXNzaWduXG4gICAgICBwYWNrYWdlSlNPTi5wcm9kdWN0TmFtZSA9IHBhY2thZ2VKU09OLm5hbWUgPSBwYXRoLmJhc2VuYW1lKGRpcmVjdG9yeSkudG9Mb3dlckNhc2UoKTtcbiAgICAgIHBhY2thZ2VKU09OLmF1dGhvciA9IGF3YWl0IGRldGVybWluZUF1dGhvcihkaXJlY3RvcnkpO1xuXG4gICAgICBwYWNrYWdlSlNPTi5zY3JpcHRzLmxpbnQgPSAnZWNobyBcIk5vIGxpbnRpbmcgY29uZmlndXJlZFwiJztcblxuICAgICAgZCgnd3JpdGluZyBwYWNrYWdlLmpzb24gdG86JywgZGlyZWN0b3J5KTtcbiAgICAgIGF3YWl0IGZzLndyaXRlSnNvbihwYXRoLnJlc29sdmUoZGlyZWN0b3J5LCAncGFja2FnZS5qc29uJyksIHBhY2thZ2VKU09OLCB7IHNwYWNlczogMiB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGFzeW5jIHVwZGF0ZUZpbGVCeUxpbmUoXG4gICAgaW5wdXRQYXRoOiBzdHJpbmcsXG4gICAgbGluZUhhbmRsZXI6IChsaW5lOiBzdHJpbmcpID0+IHN0cmluZyxcbiAgICBvdXRwdXRQYXRoPzogc3RyaW5nIHwgdW5kZWZpbmVkLFxuICApIHtcbiAgICBjb25zdCBmaWxlQ29udGVudHMgPSAoYXdhaXQgZnMucmVhZEZpbGUoaW5wdXRQYXRoLCAndXRmOCcpKS5zcGxpdCgnXFxuJykubWFwKGxpbmVIYW5kbGVyKS5qb2luKCdcXG4nKTtcbiAgICBhd2FpdCBmcy53cml0ZUZpbGUob3V0cHV0UGF0aCB8fCBpbnB1dFBhdGgsIGZpbGVDb250ZW50cyk7XG4gICAgaWYgKG91dHB1dFBhdGggIT09IHVuZGVmaW5lZCkge1xuICAgICAgYXdhaXQgZnMucmVtb3ZlKGlucHV0UGF0aCk7XG4gICAgfVxuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IG5ldyBCYXNlVGVtcGxhdGUoKTtcbiJdfQ==