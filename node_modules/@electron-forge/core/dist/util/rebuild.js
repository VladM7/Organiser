"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _asyncOra = require("@electron-forge/async-ora");

var _electronRebuild = _interopRequireDefault(require("electron-rebuild"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var _default = async (buildPath, electronVersion, platform, arch, config = {}) => {
  await (0, _asyncOra.asyncOra)('Preparing native dependencies', async rebuildSpinner => {
    const rebuilder = (0, _electronRebuild.default)({ ...config,
      buildPath,
      electronVersion,
      arch
    });
    const {
      lifecycle
    } = rebuilder;
    let found = 0;
    let done = 0;

    const redraw = () => {
      rebuildSpinner.text = `Preparing native dependencies: ${done} / ${found}`;
    };

    lifecycle.on('module-found', () => {
      found += 1;
      redraw();
    });
    lifecycle.on('module-done', () => {
      done += 1;
      redraw();
    });
    await rebuilder;
  });
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3JlYnVpbGQudHMiXSwibmFtZXMiOlsiYnVpbGRQYXRoIiwiZWxlY3Ryb25WZXJzaW9uIiwicGxhdGZvcm0iLCJhcmNoIiwiY29uZmlnIiwicmVidWlsZFNwaW5uZXIiLCJyZWJ1aWxkZXIiLCJsaWZlY3ljbGUiLCJmb3VuZCIsImRvbmUiLCJyZWRyYXciLCJ0ZXh0Iiwib24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUdBOzs7O2VBR2UsT0FDYkEsU0FEYSxFQUViQyxlQUZhLEVBR2JDLFFBSGEsRUFJYkMsSUFKYSxFQUtiQyxNQUErQixHQUFHLEVBTHJCLEtBTVY7QUFDSCxRQUFNLHdCQUFTLCtCQUFULEVBQTBDLE1BQU9DLGNBQVAsSUFBMEI7QUFDeEUsVUFBTUMsU0FBUyxHQUFHLDhCQUFRLEVBQ3hCLEdBQUdGLE1BRHFCO0FBRXhCSixNQUFBQSxTQUZ3QjtBQUd4QkMsTUFBQUEsZUFId0I7QUFJeEJFLE1BQUFBO0FBSndCLEtBQVIsQ0FBbEI7QUFNQSxVQUFNO0FBQUVJLE1BQUFBO0FBQUYsUUFBZ0JELFNBQXRCO0FBRUEsUUFBSUUsS0FBSyxHQUFHLENBQVo7QUFDQSxRQUFJQyxJQUFJLEdBQUcsQ0FBWDs7QUFFQSxVQUFNQyxNQUFNLEdBQUcsTUFBTTtBQUNuQkwsTUFBQUEsY0FBYyxDQUFDTSxJQUFmLEdBQXVCLGtDQUFpQ0YsSUFBSyxNQUFLRCxLQUFNLEVBQXhFO0FBQ0QsS0FGRDs7QUFJQUQsSUFBQUEsU0FBUyxDQUFDSyxFQUFWLENBQWEsY0FBYixFQUE2QixNQUFNO0FBQUVKLE1BQUFBLEtBQUssSUFBSSxDQUFUO0FBQVlFLE1BQUFBLE1BQU07QUFBSyxLQUE1RDtBQUNBSCxJQUFBQSxTQUFTLENBQUNLLEVBQVYsQ0FBYSxhQUFiLEVBQTRCLE1BQU07QUFBRUgsTUFBQUEsSUFBSSxJQUFJLENBQVI7QUFBV0MsTUFBQUEsTUFBTTtBQUFLLEtBQTFEO0FBRUEsVUFBTUosU0FBTjtBQUNELEdBcEJLLENBQU47QUFxQkQsQyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGFzeW5jT3JhIH0gZnJvbSAnQGVsZWN0cm9uLWZvcmdlL2FzeW5jLW9yYSc7XG5pbXBvcnQgeyBGb3JnZVBsYXRmb3JtLCBGb3JnZUFyY2ggfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2Uvc2hhcmVkLXR5cGVzJztcblxuaW1wb3J0IHJlYnVpbGQgZnJvbSAnZWxlY3Ryb24tcmVidWlsZCc7XG5pbXBvcnQgeyBSZWJ1aWxkT3B0aW9ucyB9IGZyb20gJ2VsZWN0cm9uLXJlYnVpbGQvbGliL3NyYy9yZWJ1aWxkJztcblxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgKFxuICBidWlsZFBhdGg6IHN0cmluZyxcbiAgZWxlY3Ryb25WZXJzaW9uOiBzdHJpbmcsXG4gIHBsYXRmb3JtOiBGb3JnZVBsYXRmb3JtLFxuICBhcmNoOiBGb3JnZUFyY2gsXG4gIGNvbmZpZzogUGFydGlhbDxSZWJ1aWxkT3B0aW9ucz4gPSB7fSxcbikgPT4ge1xuICBhd2FpdCBhc3luY09yYSgnUHJlcGFyaW5nIG5hdGl2ZSBkZXBlbmRlbmNpZXMnLCBhc3luYyAocmVidWlsZFNwaW5uZXIpID0+IHtcbiAgICBjb25zdCByZWJ1aWxkZXIgPSByZWJ1aWxkKHtcbiAgICAgIC4uLmNvbmZpZyxcbiAgICAgIGJ1aWxkUGF0aCxcbiAgICAgIGVsZWN0cm9uVmVyc2lvbixcbiAgICAgIGFyY2gsXG4gICAgfSk7XG4gICAgY29uc3QgeyBsaWZlY3ljbGUgfSA9IHJlYnVpbGRlcjtcblxuICAgIGxldCBmb3VuZCA9IDA7XG4gICAgbGV0IGRvbmUgPSAwO1xuXG4gICAgY29uc3QgcmVkcmF3ID0gKCkgPT4ge1xuICAgICAgcmVidWlsZFNwaW5uZXIudGV4dCA9IGBQcmVwYXJpbmcgbmF0aXZlIGRlcGVuZGVuY2llczogJHtkb25lfSAvICR7Zm91bmR9YDtcbiAgICB9O1xuXG4gICAgbGlmZWN5Y2xlLm9uKCdtb2R1bGUtZm91bmQnLCAoKSA9PiB7IGZvdW5kICs9IDE7IHJlZHJhdygpOyB9KTtcbiAgICBsaWZlY3ljbGUub24oJ21vZHVsZS1kb25lJywgKCkgPT4geyBkb25lICs9IDE7IHJlZHJhdygpOyB9KTtcblxuICAgIGF3YWl0IHJlYnVpbGRlcjtcbiAgfSk7XG59O1xuIl19