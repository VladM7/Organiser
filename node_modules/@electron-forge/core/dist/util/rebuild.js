"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _asyncOra = require("@electron-forge/async-ora");

var _electronRebuild = require("electron-rebuild");

var _default = async (buildPath, electronVersion, platform, arch, config = {}) => {
  await (0, _asyncOra.asyncOra)('Preparing native dependencies', async rebuildSpinner => {
    const rebuilder = (0, _electronRebuild.rebuild)({ ...config,
      buildPath,
      electronVersion,
      arch
    });
    const {
      lifecycle
    } = rebuilder;
    let found = 0;
    let done = 0;

    const redraw = () => {
      rebuildSpinner.text = `Preparing native dependencies: ${done} / ${found}`;
    };

    lifecycle.on('module-found', () => {
      found += 1;
      redraw();
    });
    lifecycle.on('module-done', () => {
      done += 1;
      redraw();
    });
    await rebuilder;
  });
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3JlYnVpbGQudHMiXSwibmFtZXMiOlsiYnVpbGRQYXRoIiwiZWxlY3Ryb25WZXJzaW9uIiwicGxhdGZvcm0iLCJhcmNoIiwiY29uZmlnIiwicmVidWlsZFNwaW5uZXIiLCJyZWJ1aWxkZXIiLCJsaWZlY3ljbGUiLCJmb3VuZCIsImRvbmUiLCJyZWRyYXciLCJ0ZXh0Iiwib24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUdBOztlQUVlLE9BQ2JBLFNBRGEsRUFFYkMsZUFGYSxFQUdiQyxRQUhhLEVBSWJDLElBSmEsRUFLYkMsTUFBK0IsR0FBRyxFQUxyQixLQU1LO0FBQ2xCLFFBQU0sd0JBQVMsK0JBQVQsRUFBMEMsTUFBT0MsY0FBUCxJQUEwQjtBQUN4RSxVQUFNQyxTQUFTLEdBQUcsOEJBQVEsRUFDeEIsR0FBR0YsTUFEcUI7QUFFeEJKLE1BQUFBLFNBRndCO0FBR3hCQyxNQUFBQSxlQUh3QjtBQUl4QkUsTUFBQUE7QUFKd0IsS0FBUixDQUFsQjtBQU1BLFVBQU07QUFBRUksTUFBQUE7QUFBRixRQUFnQkQsU0FBdEI7QUFFQSxRQUFJRSxLQUFLLEdBQUcsQ0FBWjtBQUNBLFFBQUlDLElBQUksR0FBRyxDQUFYOztBQUVBLFVBQU1DLE1BQU0sR0FBRyxNQUFNO0FBQ25CTCxNQUFBQSxjQUFjLENBQUNNLElBQWYsR0FBdUIsa0NBQWlDRixJQUFLLE1BQUtELEtBQU0sRUFBeEU7QUFDRCxLQUZEOztBQUlBRCxJQUFBQSxTQUFTLENBQUNLLEVBQVYsQ0FBYSxjQUFiLEVBQTZCLE1BQU07QUFDakNKLE1BQUFBLEtBQUssSUFBSSxDQUFUO0FBQ0FFLE1BQUFBLE1BQU07QUFDUCxLQUhEO0FBSUFILElBQUFBLFNBQVMsQ0FBQ0ssRUFBVixDQUFhLGFBQWIsRUFBNEIsTUFBTTtBQUNoQ0gsTUFBQUEsSUFBSSxJQUFJLENBQVI7QUFDQUMsTUFBQUEsTUFBTTtBQUNQLEtBSEQ7QUFLQSxVQUFNSixTQUFOO0FBQ0QsR0ExQkssQ0FBTjtBQTJCRCxDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgYXN5bmNPcmEgfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2UvYXN5bmMtb3JhJztcbmltcG9ydCB7IEZvcmdlUGxhdGZvcm0sIEZvcmdlQXJjaCB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9zaGFyZWQtdHlwZXMnO1xuXG5pbXBvcnQgeyByZWJ1aWxkLCBSZWJ1aWxkT3B0aW9ucyB9IGZyb20gJ2VsZWN0cm9uLXJlYnVpbGQnO1xuXG5leHBvcnQgZGVmYXVsdCBhc3luYyAoXG4gIGJ1aWxkUGF0aDogc3RyaW5nLFxuICBlbGVjdHJvblZlcnNpb246IHN0cmluZyxcbiAgcGxhdGZvcm06IEZvcmdlUGxhdGZvcm0sXG4gIGFyY2g6IEZvcmdlQXJjaCxcbiAgY29uZmlnOiBQYXJ0aWFsPFJlYnVpbGRPcHRpb25zPiA9IHt9XG4pOiBQcm9taXNlPHZvaWQ+ID0+IHtcbiAgYXdhaXQgYXN5bmNPcmEoJ1ByZXBhcmluZyBuYXRpdmUgZGVwZW5kZW5jaWVzJywgYXN5bmMgKHJlYnVpbGRTcGlubmVyKSA9PiB7XG4gICAgY29uc3QgcmVidWlsZGVyID0gcmVidWlsZCh7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBidWlsZFBhdGgsXG4gICAgICBlbGVjdHJvblZlcnNpb24sXG4gICAgICBhcmNoLFxuICAgIH0pO1xuICAgIGNvbnN0IHsgbGlmZWN5Y2xlIH0gPSByZWJ1aWxkZXI7XG5cbiAgICBsZXQgZm91bmQgPSAwO1xuICAgIGxldCBkb25lID0gMDtcblxuICAgIGNvbnN0IHJlZHJhdyA9ICgpID0+IHtcbiAgICAgIHJlYnVpbGRTcGlubmVyLnRleHQgPSBgUHJlcGFyaW5nIG5hdGl2ZSBkZXBlbmRlbmNpZXM6ICR7ZG9uZX0gLyAke2ZvdW5kfWA7XG4gICAgfTtcblxuICAgIGxpZmVjeWNsZS5vbignbW9kdWxlLWZvdW5kJywgKCkgPT4ge1xuICAgICAgZm91bmQgKz0gMTtcbiAgICAgIHJlZHJhdygpO1xuICAgIH0pO1xuICAgIGxpZmVjeWNsZS5vbignbW9kdWxlLWRvbmUnLCAoKSA9PiB7XG4gICAgICBkb25lICs9IDE7XG4gICAgICByZWRyYXcoKTtcbiAgICB9KTtcblxuICAgIGF3YWl0IHJlYnVpbGRlcjtcbiAgfSk7XG59O1xuIl19