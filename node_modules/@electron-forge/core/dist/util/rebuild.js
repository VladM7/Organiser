"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _asyncOra = require("@electron-forge/async-ora");

var _electronRebuild = require("electron-rebuild");

var _default = async (buildPath, electronVersion, platform, arch, config = {}) => {
  await (0, _asyncOra.asyncOra)('Preparing native dependencies', async rebuildSpinner => {
    const rebuilder = (0, _electronRebuild.rebuild)({ ...config,
      buildPath,
      electronVersion,
      arch
    });
    const {
      lifecycle
    } = rebuilder;
    let found = 0;
    let done = 0;

    const redraw = () => {
      rebuildSpinner.text = `Preparing native dependencies: ${done} / ${found}`;
    };

    lifecycle.on('module-found', () => {
      found += 1;
      redraw();
    });
    lifecycle.on('module-done', () => {
      done += 1;
      redraw();
    });
    await rebuilder;
  });
};

exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsL3JlYnVpbGQudHMiXSwibmFtZXMiOlsiYnVpbGRQYXRoIiwiZWxlY3Ryb25WZXJzaW9uIiwicGxhdGZvcm0iLCJhcmNoIiwiY29uZmlnIiwicmVidWlsZFNwaW5uZXIiLCJyZWJ1aWxkZXIiLCJsaWZlY3ljbGUiLCJmb3VuZCIsImRvbmUiLCJyZWRyYXciLCJ0ZXh0Iiwib24iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUFBOztBQUdBOztlQUVlLE9BQ2JBLFNBRGEsRUFFYkMsZUFGYSxFQUdiQyxRQUhhLEVBSWJDLElBSmEsRUFLYkMsTUFBK0IsR0FBRyxFQUxyQixLQU1WO0FBQ0gsUUFBTSx3QkFBUywrQkFBVCxFQUEwQyxNQUFPQyxjQUFQLElBQTBCO0FBQ3hFLFVBQU1DLFNBQVMsR0FBRyw4QkFBUSxFQUN4QixHQUFHRixNQURxQjtBQUV4QkosTUFBQUEsU0FGd0I7QUFHeEJDLE1BQUFBLGVBSHdCO0FBSXhCRSxNQUFBQTtBQUp3QixLQUFSLENBQWxCO0FBTUEsVUFBTTtBQUFFSSxNQUFBQTtBQUFGLFFBQWdCRCxTQUF0QjtBQUVBLFFBQUlFLEtBQUssR0FBRyxDQUFaO0FBQ0EsUUFBSUMsSUFBSSxHQUFHLENBQVg7O0FBRUEsVUFBTUMsTUFBTSxHQUFHLE1BQU07QUFDbkJMLE1BQUFBLGNBQWMsQ0FBQ00sSUFBZixHQUF1QixrQ0FBaUNGLElBQUssTUFBS0QsS0FBTSxFQUF4RTtBQUNELEtBRkQ7O0FBSUFELElBQUFBLFNBQVMsQ0FBQ0ssRUFBVixDQUFhLGNBQWIsRUFBNkIsTUFBTTtBQUFFSixNQUFBQSxLQUFLLElBQUksQ0FBVDtBQUFZRSxNQUFBQSxNQUFNO0FBQUssS0FBNUQ7QUFDQUgsSUFBQUEsU0FBUyxDQUFDSyxFQUFWLENBQWEsYUFBYixFQUE0QixNQUFNO0FBQUVILE1BQUFBLElBQUksSUFBSSxDQUFSO0FBQVdDLE1BQUFBLE1BQU07QUFBSyxLQUExRDtBQUVBLFVBQU1KLFNBQU47QUFDRCxHQXBCSyxDQUFOO0FBcUJELEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBhc3luY09yYSB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9hc3luYy1vcmEnO1xuaW1wb3J0IHsgRm9yZ2VQbGF0Zm9ybSwgRm9yZ2VBcmNoIH0gZnJvbSAnQGVsZWN0cm9uLWZvcmdlL3NoYXJlZC10eXBlcyc7XG5cbmltcG9ydCB7IHJlYnVpbGQsIFJlYnVpbGRPcHRpb25zIH0gZnJvbSAnZWxlY3Ryb24tcmVidWlsZCc7XG5cbmV4cG9ydCBkZWZhdWx0IGFzeW5jIChcbiAgYnVpbGRQYXRoOiBzdHJpbmcsXG4gIGVsZWN0cm9uVmVyc2lvbjogc3RyaW5nLFxuICBwbGF0Zm9ybTogRm9yZ2VQbGF0Zm9ybSxcbiAgYXJjaDogRm9yZ2VBcmNoLFxuICBjb25maWc6IFBhcnRpYWw8UmVidWlsZE9wdGlvbnM+ID0ge30sXG4pID0+IHtcbiAgYXdhaXQgYXN5bmNPcmEoJ1ByZXBhcmluZyBuYXRpdmUgZGVwZW5kZW5jaWVzJywgYXN5bmMgKHJlYnVpbGRTcGlubmVyKSA9PiB7XG4gICAgY29uc3QgcmVidWlsZGVyID0gcmVidWlsZCh7XG4gICAgICAuLi5jb25maWcsXG4gICAgICBidWlsZFBhdGgsXG4gICAgICBlbGVjdHJvblZlcnNpb24sXG4gICAgICBhcmNoLFxuICAgIH0pO1xuICAgIGNvbnN0IHsgbGlmZWN5Y2xlIH0gPSByZWJ1aWxkZXI7XG5cbiAgICBsZXQgZm91bmQgPSAwO1xuICAgIGxldCBkb25lID0gMDtcblxuICAgIGNvbnN0IHJlZHJhdyA9ICgpID0+IHtcbiAgICAgIHJlYnVpbGRTcGlubmVyLnRleHQgPSBgUHJlcGFyaW5nIG5hdGl2ZSBkZXBlbmRlbmNpZXM6ICR7ZG9uZX0gLyAke2ZvdW5kfWA7XG4gICAgfTtcblxuICAgIGxpZmVjeWNsZS5vbignbW9kdWxlLWZvdW5kJywgKCkgPT4geyBmb3VuZCArPSAxOyByZWRyYXcoKTsgfSk7XG4gICAgbGlmZWN5Y2xlLm9uKCdtb2R1bGUtZG9uZScsICgpID0+IHsgZG9uZSArPSAxOyByZWRyYXcoKTsgfSk7XG5cbiAgICBhd2FpdCByZWJ1aWxkZXI7XG4gIH0pO1xufTtcbiJdfQ==