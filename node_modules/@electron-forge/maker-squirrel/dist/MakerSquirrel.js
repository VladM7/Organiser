"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

require("source-map-support/register");

var _makerBase = _interopRequireDefault(require("@electron-forge/maker-base"));

var _electronWinstaller = require("electron-winstaller");

var _fsExtra = _interopRequireDefault(require("fs-extra"));

var _path = _interopRequireDefault(require("path"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

class MakerSquirrel extends _makerBase.default {
  constructor(...args) {
    super(...args);

    _defineProperty(this, "name", 'squirrel');

    _defineProperty(this, "defaultPlatforms", ['win32']);
  }

  isSupportedOnCurrentPlatform() {
    return this.isInstalled('electron-winstaller') && !process.env.DISABLE_SQUIRREL_TEST;
  }

  async make({
    dir,
    makeDir,
    targetArch,
    packageJSON,
    appName,
    forgeConfig
  }) {
    const outPath = _path.default.resolve(makeDir, `squirrel.windows/${targetArch}`);

    await this.ensureDirectory(outPath);
    const winstallerConfig = {
      name: packageJSON.name,
      title: appName,
      noMsi: true,
      exe: `${forgeConfig.packagerConfig.executableName || appName}.exe`,
      setupExe: `${appName}-${packageJSON.version} Setup.exe`,
      ...this.config,
      appDirectory: dir,
      outputDirectory: outPath
    };
    await (0, _electronWinstaller.createWindowsInstaller)(winstallerConfig);
    const nupkgVersion = (0, _electronWinstaller.convertVersion)(packageJSON.version);
    const artifacts = [_path.default.resolve(outPath, 'RELEASES'), _path.default.resolve(outPath, winstallerConfig.setupExe || `${appName}Setup.exe`), _path.default.resolve(outPath, `${winstallerConfig.name}-${nupkgVersion}-full.nupkg`)];

    const deltaPath = _path.default.resolve(outPath, `${winstallerConfig.name}-${nupkgVersion}-delta.nupkg`);

    if (winstallerConfig.remoteReleases || (await _fsExtra.default.pathExists(deltaPath))) {
      artifacts.push(deltaPath);
    }

    const msiPath = _path.default.resolve(outPath, winstallerConfig.setupMsi || `${appName}Setup.msi`);

    if (!winstallerConfig.noMsi && (await _fsExtra.default.pathExists(msiPath))) {
      artifacts.push(msiPath);
    }

    return artifacts;
  }

}

exports.default = MakerSquirrel;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9NYWtlclNxdWlycmVsLnRzIl0sIm5hbWVzIjpbIk1ha2VyU3F1aXJyZWwiLCJNYWtlckJhc2UiLCJpc1N1cHBvcnRlZE9uQ3VycmVudFBsYXRmb3JtIiwiaXNJbnN0YWxsZWQiLCJwcm9jZXNzIiwiZW52IiwiRElTQUJMRV9TUVVJUlJFTF9URVNUIiwibWFrZSIsImRpciIsIm1ha2VEaXIiLCJ0YXJnZXRBcmNoIiwicGFja2FnZUpTT04iLCJhcHBOYW1lIiwiZm9yZ2VDb25maWciLCJvdXRQYXRoIiwicGF0aCIsInJlc29sdmUiLCJlbnN1cmVEaXJlY3RvcnkiLCJ3aW5zdGFsbGVyQ29uZmlnIiwibmFtZSIsInRpdGxlIiwibm9Nc2kiLCJleGUiLCJwYWNrYWdlckNvbmZpZyIsImV4ZWN1dGFibGVOYW1lIiwic2V0dXBFeGUiLCJ2ZXJzaW9uIiwiY29uZmlnIiwiYXBwRGlyZWN0b3J5Iiwib3V0cHV0RGlyZWN0b3J5IiwibnVwa2dWZXJzaW9uIiwiYXJ0aWZhY3RzIiwiZGVsdGFQYXRoIiwicmVtb3RlUmVsZWFzZXMiLCJmcyIsInBhdGhFeGlzdHMiLCJwdXNoIiwibXNpUGF0aCIsInNldHVwTXNpIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFBQTs7QUFHQTs7QUFDQTs7QUFDQTs7Ozs7O0FBSWUsTUFBTUEsYUFBTixTQUE0QkMsa0JBQTVCLENBQTJEO0FBQUE7QUFBQTs7QUFBQSxrQ0FDakUsVUFEaUU7O0FBQUEsOENBR3BDLENBQUMsT0FBRCxDQUhvQztBQUFBOztBQUt4RUMsRUFBQUEsNEJBQTRCLEdBQVk7QUFDdEMsV0FBTyxLQUFLQyxXQUFMLENBQWlCLHFCQUFqQixLQUEyQyxDQUFDQyxPQUFPLENBQUNDLEdBQVIsQ0FBWUMscUJBQS9EO0FBQ0Q7O0FBRVMsUUFBSkMsSUFBSSxDQUFDO0FBQUVDLElBQUFBLEdBQUY7QUFBT0MsSUFBQUEsT0FBUDtBQUFnQkMsSUFBQUEsVUFBaEI7QUFBNEJDLElBQUFBLFdBQTVCO0FBQXlDQyxJQUFBQSxPQUF6QztBQUFrREMsSUFBQUE7QUFBbEQsR0FBRCxFQUFtRztBQUMzRyxVQUFNQyxPQUFPLEdBQUdDLGNBQUtDLE9BQUwsQ0FBYVAsT0FBYixFQUF1QixvQkFBbUJDLFVBQVcsRUFBckQsQ0FBaEI7O0FBQ0EsVUFBTSxLQUFLTyxlQUFMLENBQXFCSCxPQUFyQixDQUFOO0FBRUEsVUFBTUksZ0JBQTJDLEdBQUc7QUFDbERDLE1BQUFBLElBQUksRUFBRVIsV0FBVyxDQUFDUSxJQURnQztBQUVsREMsTUFBQUEsS0FBSyxFQUFFUixPQUYyQztBQUdsRFMsTUFBQUEsS0FBSyxFQUFFLElBSDJDO0FBSWxEQyxNQUFBQSxHQUFHLEVBQUcsR0FBRVQsV0FBVyxDQUFDVSxjQUFaLENBQTJCQyxjQUEzQixJQUE2Q1osT0FBUSxNQUpYO0FBS2xEYSxNQUFBQSxRQUFRLEVBQUcsR0FBRWIsT0FBUSxJQUFHRCxXQUFXLENBQUNlLE9BQVEsWUFMTTtBQU1sRCxTQUFHLEtBQUtDLE1BTjBDO0FBT2xEQyxNQUFBQSxZQUFZLEVBQUVwQixHQVBvQztBQVFsRHFCLE1BQUFBLGVBQWUsRUFBRWY7QUFSaUMsS0FBcEQ7QUFXQSxVQUFNLGdEQUF1QkksZ0JBQXZCLENBQU47QUFFQSxVQUFNWSxZQUFZLEdBQUcsd0NBQWVuQixXQUFXLENBQUNlLE9BQTNCLENBQXJCO0FBRUEsVUFBTUssU0FBUyxHQUFHLENBQ2hCaEIsY0FBS0MsT0FBTCxDQUFhRixPQUFiLEVBQXNCLFVBQXRCLENBRGdCLEVBRWhCQyxjQUFLQyxPQUFMLENBQWFGLE9BQWIsRUFBc0JJLGdCQUFnQixDQUFDTyxRQUFqQixJQUE4QixHQUFFYixPQUFRLFdBQTlELENBRmdCLEVBR2hCRyxjQUFLQyxPQUFMLENBQWFGLE9BQWIsRUFBdUIsR0FBRUksZ0JBQWdCLENBQUNDLElBQUssSUFBR1csWUFBYSxhQUEvRCxDQUhnQixDQUFsQjs7QUFLQSxVQUFNRSxTQUFTLEdBQUdqQixjQUFLQyxPQUFMLENBQWFGLE9BQWIsRUFBdUIsR0FBRUksZ0JBQWdCLENBQUNDLElBQUssSUFBR1csWUFBYSxjQUEvRCxDQUFsQjs7QUFDQSxRQUFJWixnQkFBZ0IsQ0FBQ2UsY0FBakIsS0FBb0MsTUFBTUMsaUJBQUdDLFVBQUgsQ0FBY0gsU0FBZCxDQUExQyxDQUFKLEVBQXlFO0FBQ3ZFRCxNQUFBQSxTQUFTLENBQUNLLElBQVYsQ0FBZUosU0FBZjtBQUNEOztBQUNELFVBQU1LLE9BQU8sR0FBR3RCLGNBQUtDLE9BQUwsQ0FBYUYsT0FBYixFQUFzQkksZ0JBQWdCLENBQUNvQixRQUFqQixJQUE4QixHQUFFMUIsT0FBUSxXQUE5RCxDQUFoQjs7QUFDQSxRQUFJLENBQUNNLGdCQUFnQixDQUFDRyxLQUFsQixLQUE0QixNQUFNYSxpQkFBR0MsVUFBSCxDQUFjRSxPQUFkLENBQWxDLENBQUosRUFBK0Q7QUFDN0ROLE1BQUFBLFNBQVMsQ0FBQ0ssSUFBVixDQUFlQyxPQUFmO0FBQ0Q7O0FBQ0QsV0FBT04sU0FBUDtBQUNEOztBQTFDdUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgTWFrZXJCYXNlLCB7IE1ha2VyT3B0aW9ucyB9IGZyb20gJ0BlbGVjdHJvbi1mb3JnZS9tYWtlci1iYXNlJztcbmltcG9ydCB7IEZvcmdlUGxhdGZvcm0gfSBmcm9tICdAZWxlY3Ryb24tZm9yZ2Uvc2hhcmVkLXR5cGVzJztcblxuaW1wb3J0IHsgY29udmVydFZlcnNpb24sIGNyZWF0ZVdpbmRvd3NJbnN0YWxsZXIsIE9wdGlvbnMgYXMgRWxlY3Ryb25XaW5zdGFsbGVyT3B0aW9ucyB9IGZyb20gJ2VsZWN0cm9uLXdpbnN0YWxsZXInO1xuaW1wb3J0IGZzIGZyb20gJ2ZzLWV4dHJhJztcbmltcG9ydCBwYXRoIGZyb20gJ3BhdGgnO1xuXG50eXBlIE1ha2VyU3F1aXJyZWxDb25maWcgPSBPbWl0PEVsZWN0cm9uV2luc3RhbGxlck9wdGlvbnMsICdhcHBEaXJlY3RvcnknIHwgJ291dHB1dERpcmVjdG9yeSc+O1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNYWtlclNxdWlycmVsIGV4dGVuZHMgTWFrZXJCYXNlPE1ha2VyU3F1aXJyZWxDb25maWc+IHtcbiAgbmFtZSA9ICdzcXVpcnJlbCc7XG5cbiAgZGVmYXVsdFBsYXRmb3JtczogRm9yZ2VQbGF0Zm9ybVtdID0gWyd3aW4zMiddO1xuXG4gIGlzU3VwcG9ydGVkT25DdXJyZW50UGxhdGZvcm0oKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMuaXNJbnN0YWxsZWQoJ2VsZWN0cm9uLXdpbnN0YWxsZXInKSAmJiAhcHJvY2Vzcy5lbnYuRElTQUJMRV9TUVVJUlJFTF9URVNUO1xuICB9XG5cbiAgYXN5bmMgbWFrZSh7IGRpciwgbWFrZURpciwgdGFyZ2V0QXJjaCwgcGFja2FnZUpTT04sIGFwcE5hbWUsIGZvcmdlQ29uZmlnIH06IE1ha2VyT3B0aW9ucyk6IFByb21pc2U8c3RyaW5nW10+IHtcbiAgICBjb25zdCBvdXRQYXRoID0gcGF0aC5yZXNvbHZlKG1ha2VEaXIsIGBzcXVpcnJlbC53aW5kb3dzLyR7dGFyZ2V0QXJjaH1gKTtcbiAgICBhd2FpdCB0aGlzLmVuc3VyZURpcmVjdG9yeShvdXRQYXRoKTtcblxuICAgIGNvbnN0IHdpbnN0YWxsZXJDb25maWc6IEVsZWN0cm9uV2luc3RhbGxlck9wdGlvbnMgPSB7XG4gICAgICBuYW1lOiBwYWNrYWdlSlNPTi5uYW1lLFxuICAgICAgdGl0bGU6IGFwcE5hbWUsXG4gICAgICBub01zaTogdHJ1ZSxcbiAgICAgIGV4ZTogYCR7Zm9yZ2VDb25maWcucGFja2FnZXJDb25maWcuZXhlY3V0YWJsZU5hbWUgfHwgYXBwTmFtZX0uZXhlYCxcbiAgICAgIHNldHVwRXhlOiBgJHthcHBOYW1lfS0ke3BhY2thZ2VKU09OLnZlcnNpb259IFNldHVwLmV4ZWAsXG4gICAgICAuLi50aGlzLmNvbmZpZyxcbiAgICAgIGFwcERpcmVjdG9yeTogZGlyLFxuICAgICAgb3V0cHV0RGlyZWN0b3J5OiBvdXRQYXRoLFxuICAgIH07XG5cbiAgICBhd2FpdCBjcmVhdGVXaW5kb3dzSW5zdGFsbGVyKHdpbnN0YWxsZXJDb25maWcpO1xuXG4gICAgY29uc3QgbnVwa2dWZXJzaW9uID0gY29udmVydFZlcnNpb24ocGFja2FnZUpTT04udmVyc2lvbik7XG5cbiAgICBjb25zdCBhcnRpZmFjdHMgPSBbXG4gICAgICBwYXRoLnJlc29sdmUob3V0UGF0aCwgJ1JFTEVBU0VTJyksXG4gICAgICBwYXRoLnJlc29sdmUob3V0UGF0aCwgd2luc3RhbGxlckNvbmZpZy5zZXR1cEV4ZSB8fCBgJHthcHBOYW1lfVNldHVwLmV4ZWApLFxuICAgICAgcGF0aC5yZXNvbHZlKG91dFBhdGgsIGAke3dpbnN0YWxsZXJDb25maWcubmFtZX0tJHtudXBrZ1ZlcnNpb259LWZ1bGwubnVwa2dgKSxcbiAgICBdO1xuICAgIGNvbnN0IGRlbHRhUGF0aCA9IHBhdGgucmVzb2x2ZShvdXRQYXRoLCBgJHt3aW5zdGFsbGVyQ29uZmlnLm5hbWV9LSR7bnVwa2dWZXJzaW9ufS1kZWx0YS5udXBrZ2ApO1xuICAgIGlmICh3aW5zdGFsbGVyQ29uZmlnLnJlbW90ZVJlbGVhc2VzIHx8IChhd2FpdCBmcy5wYXRoRXhpc3RzKGRlbHRhUGF0aCkpKSB7XG4gICAgICBhcnRpZmFjdHMucHVzaChkZWx0YVBhdGgpO1xuICAgIH1cbiAgICBjb25zdCBtc2lQYXRoID0gcGF0aC5yZXNvbHZlKG91dFBhdGgsIHdpbnN0YWxsZXJDb25maWcuc2V0dXBNc2kgfHwgYCR7YXBwTmFtZX1TZXR1cC5tc2lgKTtcbiAgICBpZiAoIXdpbnN0YWxsZXJDb25maWcubm9Nc2kgJiYgKGF3YWl0IGZzLnBhdGhFeGlzdHMobXNpUGF0aCkpKSB7XG4gICAgICBhcnRpZmFjdHMucHVzaChtc2lQYXRoKTtcbiAgICB9XG4gICAgcmV0dXJuIGFydGlmYWN0cztcbiAgfVxufVxuIl19